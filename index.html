<!DOCTYPE html>
<html>
<head>
    <style>
        .line { overflow:hidden; }
        .chamber {
            margin: 2px;
            float: left;
            width: 100px;
            height: 100px;
            background: Red;
            border-radius: 3px;
        }
        .enable { background: Gray; }
        .enable:hover { background: Black; }
        .live { background: Yellow; }
        .dead { background: Red; }
        h2 { font-family: 'Noto Sans', sans-serif; }
    </style>

    <script src = "http://code.jquery.com/jquery-2.1.4.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src = "/socket.io/socket.io.js"></script>
    <script>
        var socket = io.connect();

        socket.on('shot', function (data) {
            var $target = $('div[data-x = ' + data.x + ']');
            $target.removeClass('enable');
            if (data.result == 2) {
                $target.addClass('live');
            } else if (data.result == 4) {
                $target.addClass('dead');
            }
        });

        var onClickSlot = function () {
            var x = $(this).attr('data-x');

            $(this).off('click');
            socket.emit('shot', { x: x });
        };

        var onClickTrap = function () {
            alert("당첨!");

            var x = $(this).attr('data-x');

            $(this).off('click');
            socket.emit('shot', { x: x });
        };

        function reloadCylinder() {
            $.getJSON('/roulette', { dummy: new Date().getTime() }, function (data) {

                var $line = $('<div></div>').addClass('line');

                $.each(data, function (indexX, chamber) {
                    var $output = $('<div></div>', {
                        'class': 'chamber',
                        'data-x': indexX
                    }).appendTo($line);

                    if (chamber == 1) {
                        $output.addClass('enable').on('click', onClickSlot);
                    } else if (chamber == 2) {
                        $output.addClass('live');
                    } else if (chamber == 3) {
                        $output.addClass('enable').on('click', onClickTrap);
                    } else if (chamber == 4) {
                        $output.addClass('dead');
                    }
                });

                $('#roulette').html('');
                $line.appendTo('#roulette');
            });
        }

        socket.on('reset', function (data) {
            reloadCylinder();
        });
    </script>

    <script>
        $(document).ready(function () {

            $("#btnReset").click(function() {
                socket.emit('reset', { num: 7 });
            });

            reloadCylinder();
        });
    </script>
    <title>Russian Roulette</title>
</head>
<body>
<h2>다음 주인공은?</h2>
<div id="roulette"></div>
<button id="btnReset" class="btn btn-primary">reset</button>
</body>
</html>